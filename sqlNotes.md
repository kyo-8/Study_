## データベースの仕組み

### 表の事を「テーブル」と呼び、縦の列の事を「カラム」、横の行の事を「レコード」と呼びます。

## クエリとは

### データベースに送る命令（クエリ）。SQL(エスキューエル)とはクエリを書く為の言語。

## SELECT文

```
SELECT <どのカラムのデータ？>
FROM <どのテーブル？>;
```

## 複数のカラムからデータを取得する

### 特定の複数のカラムの場合は　,(カンマ)で区切る
### 全権取得の場合は「*」
```
SELECT <カラム1>, <カラム2>
```

## 特定のデータを取得
### WHERE句
#### WHERE」意味するのは、「どこのレコード（横の行）を取得するか


```
WHERE <カラム> = ◯◯であるレコードを
```

### 「＝」を用いて、カラムが〇〇であるレコードといった意味になるように条件を指定

### データ型
文字列 → ""</br>
数値 → </br>
日付 → ""</br>

## 比較演算子
```
SELECT * FROM <テーブル> WHERE <カラム> >= 1000;
例の場合だと1000以上
```

## LIKE演算子
### 指定したカラムが〇〇を含む（〇〇のような）レコードという条件

- 文字列を含むデータを全て取得
```
SELECT * FROM <テーブル名> WHERE <条件> LIKE <%文字列%>;
```

- 文字列から始まる(前方一致)
```
SELECT * FROM <テーブル名> WHERE <条件> LIKE <文字列%>;
```

- 文字列で終わる(後方一致)
```
SELECT * FROM <テーブル名> WHERE <条件> LIKE <%文字列>;
```

## NOT演算子
### 演算子の前に「NOT」を置くことで、その条件を満たさないデータを取得することが可能
```
SELECT * FROM <テーブル名> WHERE NOT <カラム名> LIKE "%文字列%";
```

## NULLのデータを取得する
### IS NULL(NULLである)
```
SELECT * FROM <テーブル名> WHERE <カラム名> IS NULL;
```

### IS NOT NULL(NULLではない)
```
SELECT * FROM <テーブル名> WHERE <カラム名> IS NOT NULL;
```

## AND演算子
### WHEREに複数の条件を指定することができます。「WHERE 条件１ AND 条件２」のようにすることで、条件１と条件２を共に満たすデータを検索することができる。

```
SELECT * FROM <テーブル名> WHERE <カラム名1> AND <カラム名2>;
```

## OR演算子
### 「WHERE 条件１ OR 条件２」のようにすることで、条件１または条件２のどちらかを満たすデータを検索することができる

```
SELECT * FROM <テーブル名> WHERE <カラム名1> OR <カラム名2>;
```

## ORDER BY
### データを並び替える為には、「〜順に並べる」という意味の「ORDER BY」を用い、データを並び替える為には、（基準となる）並べ替えたいカラム名」と「並べ方」を指定します

### SQLでは「昇順」は「ASC」(1,2,3...100)、「降順」は「DESC」(100...1,2,3)

### ORDER BY」は「WHERE」と併用することが可能
```
SELECT * FROM <テーブル名> WHERE <条件> ORDER BY <カラム名> DESC;
```

## LIMIT
### 「最大で何件取得するか」を指定するためには、「制限する」という意味の「LIMIT」を用います。

```
SELECT * FROM <テーブル名> LIMIT <データ数>;
```

- 「WHERE」と併用する
```
SELECT * FROM <テーブル名> WHERE <条件> LIMIT <データ数>;
```

## ORDER BYとLIMITの組み合わせ
### 「ORDER BY」と「LIMIT」を併用することも可能です。その場合、「LIMIT」を末尾にする必要がある。
```
SELECT * FROM <テーブル名> ORDER BY <カラム名> DESC LIMIT <データ数>;
```

## DISTINCT
### DISTINCTを用いると、検索結果から重複するデータを除くことが可能
```
SELECT DISTINCT(<カラム名>) FROM <テーブル名>;
```

## SUM関数
### SQLで数値の合計を計算する場合は、SUMを用います。
```
SELECT SUM(<カラム名>) FROM <テーブル名>;
```

## WHEREとSUM関数
### 検索したレコードの数値の合計を計算し、カラムの文字列のレコードを検索する。
```
SELECT SUM(<カラム名>) FROM <テーブル名> WHERE <カラム名> = "文字列";
```

## AVG関数
### 「AVG(カラム名)」のようにすることで、指定したカラムに保存されたデータの平均を計算することが可能です。AVG関数はSELECTで取得するカラムに使用することで、計算結果を取得することができます。

```
SELECT AVG(<カラム名>) FROM <テーブル名>;
```

## WHEREとAVG関数
### AVG関数はWHEREと併用することができます。

```
SELECT AVG(<カラム名>) FROM <テーブル名> WHERE <カラム名> = "文字列";
```

## COUNT関数
### COUNT関数は、指定したカラムのデータの合計数を計算してくれる関数です。

## COUNT関数とnull
### COUNT関数でカラム名を指定した場合、nullになっているデータの数は計算されません。

## COUNT関数の使い方
### nullの数も含めてデータの数を計算したい場合は、COUNT関数で * (全てのカラム)を指定します。* を使った場合、特定のカラムのデータの数ではなく、レコードの数を計算します。この方法で、nullの数を含めてデータの数を数えられます。

## WHEREとCOUNT関数
### COUNT関数はWHEREと併用することができます。

```
SELECT COUNT(*) FROM <テーブル名> WHERE <カラム名> = "文字列";
```

## MAX・MIN関数
### SQLでMAXという関数を用いると、指定したカラムのデータの中から最大のデータを取得することができます。同じく、MINと言う関数を用いることで、最小のデータを取得することができます。

## MAX・MIN関数の使い方
### MAX,MINも他の集計関数と同様にSELECTで取得したカラムに使用することができます。priceカラムを指定することでもっとも値段が高かった商品のデータを取得することができます。

```
SELECT MAX(<カラム名>) FROM <テーブル名>;
```

## WHEREとMAX・MIN関数

```
SELECT MAX(<カラム名>) FROM <テーブル名> WHERE <カラム名> = "文字列";
```

## GROUP BY
### GROUP BYを用いると、データをグループ化することができます。

## グループ化と集計
### グループ化するには、今までの集計関数を取得するFROMの後ろに「GROUP BY カラム名」を追加します。集計関数により、各グループごとにデータが集計されます。

```
SELECT SUM(<カラム名1>), <カラム名2> FROM <テーブル名> GROUP BY <カラム名2>;
```

## GROUP BYの注意点
### GROUP BYを用いる場合、SELECTで使えるのは、GROUP BYに指定しているカラム名と、集計関数のみです。

## 複数カラムのGROUP BYの書き方
### , で繋げる

```
SELECT SUM(<カラム名1>), <カラム名2>, <カラム名3> FROM <テーブル名> GROUP BY <カラム名2> <カラム名3>;
```

## WHEREとGROUP BY
### GROUP BYはWHEREとも併用することができ、その場合はWHEREの後に書きます。WHEREとGROUP BYと集計関数は以下の順番で実行されていきます。右下の図のようにWHEREはまず最初に、そのあとにGROUP BYと関数が実行されます。


| 検索 | WHERE |
|:-------------|:------------|
| グループ化 | GROUP BY |
| 関数 | COUNT/SUM/AVG/MAX/MIN |

## WHERE と GROUP BYの書き方
```
SELECT SUM(<カラム名1>), <カラム名2>, <カラム名3> FROM <テーブル名> WHERE <カラム名4> = "文字列" GROUP BY <カラム名2> <カラム名3>;
```

## HAVING
### GROUP BYでグループ化したデータを更に絞り込みたい場合には、HAVINGを用います。図のように「GROUP BY カラム名 HAVING 条件」のようにすることで、条件を満たすグループを取得することができます。

## WHEREとHAVING
### グループ化した後のデータを絞り込む際、WHEREではなくHAVINGを使うのは、SQLの各コマンドが以下の順番で実行されていくためです。図のようにWHEREはまず最初に、そのあとにGROUP BYと関数が実行され、その後にHAVINGが実行されます。

| 検索 | WHERE |
|:-------------|:------------|
| グループ化 | GROUP BY |
| 関数 | COUNT/SUM/AVG/MAX/MIN |
| HAVING | HAVING |

## WHEREとHAVINGの違い
### 実行順序によって、WHEREとHAVINGは検索対象に違いがあります。WHEREはグループ化される前のテーブル全体を検索対象とするのに対し、HAVINGはGROUP BYによってグループ化されたデータを検索対象とします。

## HAVINGの注意点
### HAVINGはグループ化された後のテーブルから検索するため、条件文で使うカラムは必ずグループ化されたテーブルのカラムを使います。

```
SELECT SUM(<カラム名1>) FROM <テーブル名> GROUP BY <カラム名1> HAVING (条件式);
```


## サブクエリとは
### SQLでは、クエリの中に他のクエリを入れることができます。この他のクエリをサブクエリと言います。2つ以上のクエリを1つにまとめることができるので、より複雑なデータを取得する際に使われます。

## サブクエリの書き方
### ( )で囲むことで、サブクエリを使用できます。サブクエリの書き方は基本的に通常のクエリと同じですが、()内にセミコロン（;）は不要です。セミコロン（;）はクエリの最後にだけ書くようにしましょう。

```
SELECT <カラム名1> FROM <テーブル名> WHERE <カラム名2> > (SELECT <カラム名2> FROM <テーブル名> WHERE <カラム名1> = "文字列");
```

## ASの使い方
### ASを使うことでカラム名などに別名を定義することができます。「カラム名 AS "名前"」で、カラム名に定義する名前を指定します。

```
SELECT <カラム名1> AS "文字列1" FROM <テーブル名> WHERE <カラム名2> = "文字列2";
```

## テーブルが紐づく仕組み
### テーブルを紐づけるために、外部キーと主キーを使います。外部キーで他のテーブルにある主キーを指定することで、テーブル同士を紐付けることができます。

## JOINとは
### JOINは複数のテーブルを1つに結合したいときに使います。ONで条件を指定して、テーブルAにテーブルBを結合します。結合したテーブルは1つのテーブルとしてデータを取得することができます。

```
<カラム名1>が外部キーで<カラム名2>が主キー
SELECT * FROM <テーブル名1> JOIN <テーブル名2> ON <テーブル名1>.<カラム名1> = <テーブル名2>.<カラム名2>;
```

## JOINの実行順序
### 図のようなJOINを含んだクエリでは、はじめにJOINが実行されます。その次に、結合されたテーブルに対してSELECTが実行されます。

## 複数テーブルでのカラムの指定(1)
### 複数のテーブルに同じカラム名が存在するときは、「テーブル名.カラム名」で指定しなければなりません。例えば、図のようにnameカラムが複数のテーブルにあるときは、「それぞれのテーブル名.name」で指定しましょう。「テーブル名.カラム名」を用いたカラム指定は、WHERE内でも使えます。複数テーブルを扱うときは、異なるテーブルで同じカラム名が存在する場合があるので覚えておきましょう。

## 全体実行順序の確認
### GROUP BYなどを含んだ実行順序を確認しましょう。SQLは、取得するテーブルを形成してから検索を行うので、FROM・JOINが先に行われることを覚えておきましょう。

| テーブルの指定 | FROM |
|:-------------|:------------|
| 結合 | ON/JOIN |
| 取得条件 | WHERE |
| グループ化 | GROUP BY |
| 関数 | COUNT/SUM/AVG/MAX/MIN |
| HAVING | HAVING |
| 検索 | SELECT/DISTINCT |
| 順序 | ORDER BY |
| LIMIT | LIMIT |

## NULLを含んだ場合の実行結果
### JOINを使った結合は、FROMで指定したテーブルを基準に実行されます。ただし、外部キーがNULLのレコードは、実行結果に表示されません。

## LEFT JOINとは
### LEFT JOINを使うことで、FROMで指定したテーブルのレコードを全て取得します。外部キーがNULLのレコードもNULLのまま実行結果に表示されます。

- LEFT JOINを使うと基となるテーブルのレコードを全て取得する。(<テーブル名1>)

```
SELECT * FROM <テーブル名1> LEFT JOIN <テーブル名2> ON <テーブル名1>.<カラム名1> = <テーブル名2>.<カラム名2>;
```

## 複数テーブルのJOIN
### JOINは1つのクエリで、複数回使用できます。JOINを複数回使用しても、FROMは1度だけ書けば大丈夫なので注意しましょう。

```
SELECT * FROM <テーブル名1> JOIN <テーブル名2> ON <テーブル名1>.<カラム名1> = <テーブル名2>.<カラム名2> LEFT JOIN <テーブル名3> ON <テーブル名1>.<カラム名2> = <テーブル名3>.<カラム名3>;
```
